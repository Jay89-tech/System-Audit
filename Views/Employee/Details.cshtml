@model SkillsAuditSystem.Models.ViewModels.EmployeeDetailsViewModel

@{
    ViewData["Title"] = "Employee Details";
}

<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1><i class="fas fa-user"></i> @Model.Employee.Name</h1>
            <div class="breadcrumb">
                <a asp-controller="Dashboard" asp-action="Index" style="color: #6b7280; text-decoration: none;">Home</a>
                <span>/</span>
                <a asp-controller="Employee" asp-action="Index" style="color: #6b7280; text-decoration: none;">Employees</a>
                <span>/</span>
                <span>Details</span>
            </div>
        </div>
        <div style="display: flex; gap: 10px;">
            <a asp-action="DetailedReport" asp-route-id="@Model.Employee.Id" class="btn btn-danger">
                <i class="fas fa-file-pdf"></i> Generate Report
            </a>
            <a asp-action="Edit" asp-route-id="@Model.Employee.Id" class="btn btn-primary">
                <i class="fas fa-edit"></i> Edit
            </a>
        </div>
    </div>
</div>

<!-- Employee Info & Stats -->
<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px;">
    <!-- Profile Card -->
    <div class="card">
        <div class="card-body" style="text-align: center;">
            <div style="width: 120px; height: 120px; border-radius: 50%; background-color: var(--deep-blue); color: var(--white); display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: 700; margin: 0 auto 20px;">
                @Model.Employee.Name.Substring(0, 1).ToUpper()
            </div>
            <h2 style="margin-bottom: 5px;">@Model.Employee.Name</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">@Model.Employee.Profession</p>

            <div style="text-align: left; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--soft-grey);">
                <p style="margin-bottom: 10px;">
                    <i class="fas fa-envelope" style="color: var(--deep-blue); width: 20px;"></i>
                    <span style="font-size: 14px;">@Model.Employee.Email</span>
                </p>
                <p style="margin-bottom: 10px;">
                    <i class="fas fa-phone" style="color: var(--deep-blue); width: 20px;"></i>
                    <span style="font-size: 14px;">@Model.Employee.CellNumber</span>
                </p>
                <p style="margin-bottom: 10px;">
                    <i class="fas fa-calendar" style="color: var(--deep-blue); width: 20px;"></i>
                    <span style="font-size: 14px;">Joined @Model.Employee.CreatedAt.ToString("MMM dd, yyyy")</span>
                </p>
                <p>
                    <i class="fas fa-circle" style="color: @(Model.Employee.IsActive ? "var(--success)" : "var(--danger)"); width: 20px;"></i>
                    <span style="font-size: 14px;">@(Model.Employee.IsActive ? "Active" : "Inactive")</span>
                </p>
            </div>

            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--soft-grey);">
                <form asp-action="ToggleStatus" asp-route-id="@Model.Employee.Id" method="post" style="display: inline;">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn @(Model.Employee.IsActive ? "btn-warning" : "btn-success")" style="width: 100%;">
                        <i class="fas fa-power-off"></i> @(Model.Employee.IsActive ? "Deactivate" : "Activate")
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Stats -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
        <div class="stat-card">
            <h4>Qualifications</h4>
            <div class="stat-value">@Model.TotalQualifications</div>
            <p style="font-size: 14px; opacity: 0.9;">@Model.ApprovedQualifications approved</p>
        </div>

        <div class="stat-card success">
            <h4>Skills</h4>
            <div class="stat-value">@Model.TotalSkills</div>
            <p style="font-size: 14px; opacity: 0.9;">Recorded skills</p>
        </div>

        <div class="stat-card info">
            <h4>Trainings</h4>
            <div class="stat-value">@Model.CompletedTrainings</div>
            <p style="font-size: 14px; opacity: 0.9;">@Model.InProgressTrainings in progress</p>
        </div>
    </div>
</div>

<!-- Tabs Section -->
<div class="card">
    <div class="card-body">
        <div style="border-bottom: 2px solid var(--soft-grey); margin-bottom: 20px;">
            <div style="display: flex; gap: 20px;">
                <button class="tab-btn active" onclick="showTab('qualifications')" style="padding: 10px 20px; background: none; border: none; border-bottom: 3px solid var(--deep-blue); color: var(--deep-blue); font-weight: 600; cursor: pointer;">
                    <i class="fas fa-certificate"></i> Qualifications
                </button>
                <button class="tab-btn" onclick="showTab('trainings')" style="padding: 10px 20px; background: none; border: none; border-bottom: 3px solid transparent; color: #6b7280; font-weight: 600; cursor: pointer;">
                    <i class="fas fa-graduation-cap"></i> Trainings
                </button>
                <button class="tab-btn" onclick="showTab('skills')" style="padding: 10px 20px; background: none; border: none; border-bottom: 3px solid transparent; color: #6b7280; font-weight: 600; cursor: pointer;">
                    <i class="fas fa-tools"></i> Skills
                </button>
            </div>
        </div>

        <!-- Qualifications Tab -->
        <div id="qualifications-tab" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Qualifications</h3>
            </div>
            @if (Model.Qualifications.Any())
            {
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Qualification</th>
                                <th>Institution</th>
                                <th>Year</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var qual in Model.Qualifications)
                            {
                                <tr>
                                    <td style="font-weight: 500;">@qual.QualificationName</td>
                                    <td>@qual.Institution</td>
                                    <td>@(qual.YearObtained?.ToString() ?? "N/A")</td>
                                    <td>
                                        @if (qual.Status == "approved")
                                        {
                                            <span class="badge badge-success">Approved</span>
                                        }
                                        else if (qual.Status == "pending")
                                        {
                                            <span class="badge badge-warning">Pending</span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-danger">Rejected</span>
                                        }
                                    </td>
                                    <td>
                                        <a asp-controller="Qualification" asp-action="Details" asp-route-id="@qual.Id" class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">
                                            View
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p style="text-align: center; color: #6b7280; padding: 20px;">No qualifications recorded</p>
            }
        </div>

        <!-- Trainings Tab -->
        <div id="trainings-tab" class="tab-content" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Trainings</h3>
                <a asp-controller="Training" asp-action="SuggestTraining" asp-route-employeeId="@Model.Employee.Id" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Suggest Training
                </a>
            </div>
            @if (Model.Trainings.Any())
            {
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Training Name</th>
                                <th>Status</th>
                                <th>Progress</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var training in Model.Trainings)
                            {
                                <tr>
                                    <td style="font-weight: 500;">@training.TrainingName</td>
                                    <td>
                                        @{
                                            var badgeClass = training.Status switch
                                            {
                                                "completed" => "badge-success",
                                                "in_progress" => "badge-info",
                                                "suggested" => "badge-warning",
                                                _ => "badge-secondary"
                                            };
                                            var statusLabel = training.Status.Replace("_", " ");
                                        }
                                        <span class="badge @badgeClass">@statusLabel</span>
                                    </td>
                                    <td>
                                        <div style="background-color: var(--soft-grey); height: 10px; border-radius: 5px; overflow: hidden; width: 100px;">
                                            <div style="background-color: var(--success); height: 100%; width: @training.Progress%;"></div>
                                        </div>
                                        <span style="font-size: 12px;">@training.Progress%</span>
                                    </td>
                                    <td>
                                        <a asp-controller="Training" asp-action="Details" asp-route-id="@training.Id" class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">
                                            View
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p style="text-align: center; color: #6b7280; padding: 20px;">No trainings recorded</p>
            }
        </div>

        <!-- Skills Tab -->
        <div id="skills-tab" class="tab-content" style="display: none;">
            <h3 style="margin-bottom: 20px;">Skills</h3>
            @if (Model.Skills.Any())
            {
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                    @foreach (var skill in Model.Skills)
                    {
                        <div style="background-color: #f9fafb; padding: 15px; border-radius: 8px; border-left: 4px solid var(--deep-blue);">
                            <h4 style="margin-bottom: 5px; color: var(--dark-grey);">@skill.SkillName</h4>
                            <p style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">@skill.Category</p>
                            <span class="badge badge-info">@skill.ProficiencyLevel</span>
                            @if (skill.YearsOfExperience.HasValue)
                            {
                                <span style="font-size: 12px; color: #6b7280; margin-left: 10px;">@skill.YearsOfExperience years exp.</span>
                            }
                        </div>
                    }
                </div>
            }
            else
            {
                <p style="text-align: center; color: #6b7280; padding: 20px;">No skills recorded</p>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.style.borderBottom = '3px solid transparent';
                btn.style.color = '#6b7280';
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').style.display = 'block';

            // Add active class to clicked button
            event.target.style.borderBottom = '3px solid var(--deep-blue)';
            event.target.style.color = 'var(--deep-blue)';
        }
    </script>
}