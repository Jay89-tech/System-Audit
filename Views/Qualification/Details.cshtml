@model SkillsAuditSystem.Models.Qualification

@{
    ViewData["Title"] = "Qualification Details";
    var employee = ViewBag.Employee as SkillsAuditSystem.Models.Employee;
}

<div class="page-header">
    <h1><i class="fas fa-certificate"></i> Qualification Details</h1>
    <div class="breadcrumb">
        <a asp-controller="Dashboard" asp-action="Index" style="color: #6b7280; text-decoration: none;">Home</a>
        <span>/</span>
        <a asp-action="PendingApprovals" style="color: #6b7280; text-decoration: none;">Qualifications</a>
        <span>/</span>
        <span>Details</span>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>@Model.QualificationName</h3>
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <!-- Left Column -->
            <div>
                <h4 style="margin-bottom: 20px; color: var(--dark-grey);">Qualification Information</h4>

                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Qualification Name</label>
                    <p style="font-size: 16px; margin-top: 5px;">@Model.QualificationName</p>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Institution</label>
                    <p style="font-size: 16px; margin-top: 5px;">@Model.Institution</p>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Year Obtained</label>
                    <p style="font-size: 16px; margin-top: 5px;">@(Model.YearObtained?.ToString() ?? "Not specified")</p>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Status</label>
                    <p style="margin-top: 5px;">
                        @if (Model.Status == "approved")
                        {
                            <span class="badge badge-success">Approved</span>
                        }
                        else if (Model.Status == "pending")
                        {
                            <span class="badge badge-warning">Pending</span>
                        }
                        else
                        {
                            <span class="badge badge-danger">Rejected</span>
                        }
                    </p>
                </div>

                @if (!string.IsNullOrEmpty(Model.CertificateUrl))
                {
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Certificate</label>
                        <div style="margin-top: 10px;">
                            <a href="@Model.CertificateUrl" target="_blank" class="btn btn-primary">
                                <i class="fas fa-download"></i> View Certificate
                            </a>
                        </div>
                    </div>
                }
            </div>

            <!-- Right Column -->
            <div>
                <h4 style="margin-bottom: 20px; color: var(--dark-grey);">Employee Information</h4>

                @if (employee != null)
                {
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Employee Name</label>
                        <p style="font-size: 16px; margin-top: 5px;">
                            <a asp-controller="Employee" asp-action="Details" asp-route-id="@employee.Id" style="color: var(--deep-blue); text-decoration: none;">
                                @employee.Name
                            </a>
                        </p>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Profession</label>
                        <p style="font-size: 16px; margin-top: 5px;">@employee.Profession</p>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Email</label>
                        <p style="font-size: 16px; margin-top: 5px;">@employee.Email</p>
                    </div>
                }

                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Submitted On</label>
                    <p style="font-size: 16px; margin-top: 5px;">@Model.CreatedAt.ToString("MMMM dd, yyyy")</p>
                </div>

                @if (Model.ApprovedBy != null)
                {
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Approved By</label>
                        <p style="font-size: 16px; margin-top: 5px;">@Model.ApprovedBy</p>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600; color: #6b7280; font-size: 14px;">Approved On</label>
                        <p style="font-size: 16px; margin-top: 5px;">@Model.ApprovedAt?.ToString("MMMM dd, yyyy")</p>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.RejectionReason))
                {
                    <div style="margin-top: 20px; padding: 15px; background-color: #fee2e2; border-left: 4px solid #ef4444; border-radius: 8px;">
                        <label style="font-weight: 600; color: #991b1b; font-size: 14px;">Rejection Reason</label>
                        <p style="color: #991b1b; margin-top: 5px;">@Model.RejectionReason</p>
                    </div>
                }
            </div>
        </div>

        @if (Model.Status == "pending")
        {
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #d3d3d3;">
                <h4 style="margin-bottom: 15px;">Take Action</h4>
                <div style="display: flex; gap: 10px;">
                    <form asp-action="Approve" asp-route-id="@Model.Id" method="post" style="display: inline;">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-success" onclick="return confirm('Approve this qualification?');">
                            <i class="fas fa-check"></i> Approve
                        </button>
                    </form>

                    <button type="button" class="btn btn-danger" onclick="showRejectModal()">
                        <i class="fas fa-times"></i> Reject
                    </button>

                    <a asp-action="PendingApprovals" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>
                </div>
            </div>
        }
        else
        {
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #d3d3d3;">
                <a asp-action="PendingApprovals" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to List
                </a>
            </div>
        }
    </div>
</div>

<!-- Reject Modal -->
<div class="modal" id="rejectModal" style="display: none;">
    <div class="modal-content">
        <h3>Reject Qualification</h3>
        <form asp-action="Reject" asp-route-id="@Model.Id" method="post">
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label for="rejectionReason" class="form-label">Reason for Rejection *</label>
                <textarea name="rejectionReason" id="rejectionReason" class="form-control" rows="4" required></textarea>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button type="button" class="btn btn-secondary" onclick="hideRejectModal()">Cancel</button>
                <button type="submit" class="btn btn-danger">Reject Qualification</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function showRejectModal() {
            document.getElementById('rejectModal').style.display = 'flex';
        }

        function hideRejectModal() {
            document.getElementById('rejectModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            var modal = document.getElementById('rejectModal');
            if (event.target == modal) {
                hideRejectModal();
            }
        }
    </script>
}